# argo

ğŸ™ GitOps for Homelab Kubernetes Cluster

## Setup

This argo repository follows an [app of apps](https://argo-cd.readthedocs.io/en/stable/operator-manual/cluster-bootstrapping/) pattern, bootstrapped by the helm chart `inventory/`.

To get stated, setup a [GitHub app](https://docs.github.com/en/developers/apps/building-github-apps/creating-a-github-app), and pull its private key. Install it to a repository, and change/override the relevant vars in `script/bootstrap`. You'll need `kubectl`, `argocd` and `kustomize` in your PATH.

It will do the following:

1. Create an `argocd` namespace.
2. Install argocd kustomization manifests from `install/`.
3. Login to argo via port forward.
4. Add the repository to argo, using the GitHub app's access.
5. Setup the inventory app from `inventory/`

After that, all that's needed is a sync ğŸ”„ and the applications are ready!

## Structure

```
.
â”œâ”€â”€ install
â”œâ”€â”€ apps
â”‚   â””â”€â”€ <project>
â”‚       â””â”€â”€ <application>
â”œâ”€â”€ inventory
â”‚   â””â”€â”€ values.yaml
â””â”€â”€ script
```

### `install/`

Basic kustomization of argo's default install manifests. This is used both within the initial bootstrap and later as a self-managed application with the inventory (`apps/utils/argocd/application.yaml`).

### `apps/`

These are where all the argo applications are stored, organized by the directory structure, following the pattern `apps/<project>/<application>`. The argo resources for these folders will be automatically generate by the `inventory` app.

### `inventory/`

This helm app generates the argo CRDs for `AppProject` and `Application` based on the folder structure. The templating is controlled by the `values.yaml` and can be automatically generated by `script/generate-inventory`.

### `script/`

This directory holds utility scripts, and is loosely based on the [`scripts-to-rule-them-all`](https://github.com/github/scripts-to-rule-them-all) pattern.

- `script/bootstrap`: will do _most_ of the heavy lifting to go from zero to running argo setup.

- `script/generate-inventory`: generates the `inventory/values.yml` based on the folder structure of `apps/`.
